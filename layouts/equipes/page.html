{{ define "main" }}
  <article class="team">
    {{ with .Params.image }}
      <div class="text-center">
        <img src="{{ . }}" class="rounded img-fluid" alt="{{ page.Title }} image" />
      </div>
    {{ end }}
    {{ if .Draft }}
      <span class="badge bg-warning float-end">Brouillon</span>
    {{ end }}
    <h1>{{ .Title }}</h1>
    {{ .Content }}

    {{ $elements := .Resources.Match "images/*.jpg" }}
    {{ with $elements }}
      <h2>Galerie</h2>
      <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          {{ range $index, $element := $elements }}
            <div class="carousel-item {{ if (eq $index 0) }}active{{ end }}">
              {{ with $element.Fill "800x450" }}
                <img src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" alt="" />
              {{ end }}
            </div>
          {{ end }}
        </div>
        <button
          class="carousel-control-prev"
          type="button"
          data-bs-target="#carouselExampleAutoplaying"
          data-bs-slide="prev"
        >
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button
          class="carousel-control-next"
          type="button"
          data-bs-target="#carouselExampleAutoplaying"
          data-bs-slide="next"
        >
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    {{ end }}
  </article>

  {{ with .Params.calendarName }}
    <div class="calendar">
      <h3>Calendrier des matchs</h3>
      <div id="loading-message" class="alert alert-info">Chargement des données...</div>
      <div id="table-container"></div>
    </div>
    <script src="/js/load-calendar.js"></script>
    <script>
      loadCalendar('/calendars/{{ . }}.json', 'table-container')
      // Masquer le message de chargement une fois les données chargées
      document.addEventListener('DOMContentLoaded', function () {
        const loadingMessage = document.getElementById('loading-message')
        const tableContainer = document.getElementById('table-container')

        // Observateur pour détecter quand le tableau est chargé
        const observer = new MutationObserver(function (mutations) {
          if (tableContainer.children.length > 0) {
            loadingMessage.style.display = 'none'
            observer.disconnect()
          }
        })

        observer.observe(tableContainer, { childList: true })
      })
    </script>
  {{ end }}
{{ end }}
